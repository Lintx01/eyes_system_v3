{% extends 'base.html' %}
{% load static %}

{% block title %}ç»ƒä¹ ç»“æœ - {{ exercise.case.title }}{% endblock %}

{% block extra_css %}
<style>
.result-container {
    max-width: 900px;
    margin: 0 auto;
}

.result-header {
    text-align: center;
    padding: 30px;
    border-radius: 8px;
    margin-bottom: 30px;
}

.result-correct {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
    border: 2px solid #28a745;
    color: #155724;
}

.result-incorrect {
    background: linear-gradient(135deg, #f8d7da, #f5c6cb);
    border: 2px solid #dc3545;
    color: #721c24;
}

.result-icon {
    font-size: 4rem;
    margin-bottom: 15px;
    display: block;
}

.result-title {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 10px;
}

.result-subtitle {
    font-size: 1.1rem;
    opacity: 0.8;
}

.answer-comparison {
    background: white;
    border-radius: 8px;
    padding: 30px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.answer-section {
    margin-bottom: 25px;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #ddd;
}

.user-answer {
    border-left-color: #dc3545;
    background: #fff5f5;
}

.correct-answer {
    border-left-color: #28a745;
    background: #f8fff8;
}

.answer-label {
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 1.1rem;
}

.answer-text {
    font-size: 1.1rem;
    line-height: 1.4;
}

.explanation-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 30px;
    border-left: 4px solid #17a2b8;
}

.explanation-title {
    color: #17a2b8;
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 15px;
}

.explanation-text {
    line-height: 1.6;
    font-size: 1.05rem;
    color: #333;
}

.question-review {
    background: white;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.navigation-section {
    text-align: center;
    padding: 20px;
}

.button-group {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

@media (max-width: 600px) {
    .button-group {
        flex-direction: column;
        align-items: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="result-container">
    <!-- ç»“æœæ˜¾ç¤º -->
    <div class="result-header {% if is_correct %}result-correct{% else %}result-incorrect{% endif %}">
        <span class="result-icon">
            {% if is_correct %}âœ…{% else %}âŒ{% endif %}
        </span>
        <div class="result-title">
            {% if is_correct %}å›ç­”æ­£ç¡®ï¼{% else %}å›ç­”é”™è¯¯{% endif %}
        </div>
        <div class="result-subtitle">
            {% if is_correct %}
                æ­å–œæ‚¨ç­”å¯¹äº†è¿™é“é¢˜ç›®ï¼Œç»§ç»­åŠ æ²¹ï¼
            {% else %}
                æ²¡å…³ç³»ï¼Œä»é”™è¯¯ä¸­å­¦ä¹ ï¼Œä¸‹æ¬¡ä¼šæ›´å¥½ï¼
            {% endif %}
        </div>
    </div>

    <!-- é¢˜ç›®å›é¡¾ -->
    <div class="question-review">
        <h3 style="color: #b71c1c; margin-bottom: 20px;">
            <i style="margin-right: 8px;">ğŸ“</i>é¢˜ç›®å›é¡¾
        </h3>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <strong>ç—…ä¾‹ï¼š</strong>{{ exercise.case.title }}<br>
            <strong>é¢˜å‹ï¼š</strong>{{ exercise.get_question_type_display }}
        </div>
        <div style="font-size: 1.1rem; line-height: 1.6;">
            {{ exercise.question|linebreaks }}
        </div>
    </div>

    <!-- ç­”æ¡ˆå¯¹æ¯” -->
    <div class="answer-comparison">
        <h3 style="color: #b71c1c; margin-bottom: 25px;">
            <i style="margin-right: 8px;">ğŸ”</i>ç­”æ¡ˆå¯¹æ¯”
        </h3>

        <div class="answer-section user-answer">
            <div class="answer-label">
                <i style="margin-right: 5px;">ğŸ‘¤</i>æ‚¨çš„ç­”æ¡ˆï¼š
            </div>
            <div class="answer-text">
                {% if exercise.question_type == 'single' or exercise.question_type == 'multiple' %}
                    {% with options=exercise.get_options_list %}
                        {% for option in options %}
                            {% if forloop.counter0|add:0 == user_answer|add:0 %}
                                {{ option }}
                            {% endif %}
                        {% endfor %}
                    {% endwith %}
                {% elif exercise.question_type == 'judge' %}
                    {% if user_answer == 'T' %}
                        <strong>âœ“</strong> æ­£ç¡®
                    {% else %}
                        <strong>âœ—</strong> é”™è¯¯
                    {% endif %}
                {% else %}
                    {{ user_answer }}
                {% endif %}
            </div>
        </div>

        <div class="answer-section correct-answer">
            <div class="answer-label">
                <i style="margin-right: 5px;">âœ…</i>æ­£ç¡®ç­”æ¡ˆï¼š
            </div>
            <div class="answer-text">
                {% if exercise.question_type == 'single' or exercise.question_type == 'multiple' %}
                    {% with options=exercise.get_options_list %}
                        {% for option in options %}
                            {% if forloop.counter0 == 0 and correct_answer == 'A' %}
                                {{ option }}
                            {% elif forloop.counter0 == 1 and correct_answer == 'B' %}
                                {{ option }}
                            {% elif forloop.counter0 == 2 and correct_answer == 'C' %}
                                {{ option }}
                            {% elif forloop.counter0 == 3 and correct_answer == 'D' %}
                                {{ option }}
                            {% elif forloop.counter0 == 4 and correct_answer == 'E' %}
                                {{ option }}
                            {% elif forloop.counter0 == 5 and correct_answer == 'F' %}
                                {{ option }}
                            {% endif %}
                        {% endfor %}
                    {% endwith %}
                {% elif exercise.question_type == 'judge' %}
                    {% if correct_answer == 'T' %}
                        <strong>âœ“</strong> æ­£ç¡®
                    {% else %}
                        <strong>âœ—</strong> é”™è¯¯
                    {% endif %}
                {% else %}
                    {{ correct_answer }}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ç­”æ¡ˆè§£æ -->
    {% if explanation %}
    <div class="explanation-section">
        <div class="explanation-title">
            <i style="margin-right: 8px;">ğŸ’¡</i>ç­”æ¡ˆè§£æ
        </div>
        <div class="explanation-text">
            {{ explanation|linebreaks }}
        </div>
    </div>
    {% endif %}

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div class="navigation-section">
        <div class="button-group">
            <a href="{% url 'student_case_detail' exercise.case.id %}" class="btn secondary">
                <i style="margin-right: 5px;">â¬…ï¸</i>è¿”å›ç—…ä¾‹
            </a>
            
            <a href="{% url 'clinical_case_list' %}" class="btn">
                <i style="margin-right: 5px;">ğŸ“š</i>ç»§ç»­å­¦ä¹ 
            </a>
            
            <a href="{% url 'student_dashboard' %}" class="btn secondary">
                <i style="margin-right: 5px;">ğŸ </i>å›åˆ°é¦–é¡µ
            </a>
        </div>
        
        <div style="margin-top: 20px; color: #666; font-size: 0.9rem;">
            <i style="margin-right: 5px;">ğŸ¯</i>
            {% if is_correct %}
                æ‚¨å·²æˆåŠŸå®Œæˆè¿™é“ç»ƒä¹ é¢˜ï¼Œå­¦ä¹ è¿›åº¦å·²æ›´æ–°ï¼
            {% else %}
                å»ºè®®é‡æ–°é˜…è¯»ç›¸å…³ç—…ä¾‹å†…å®¹ï¼Œå·©å›ºçŸ¥è¯†ç‚¹ã€‚
            {% endif %}
        </div>
    </div>
</div>

<script>
// é¡µé¢åŠ è½½å®Œæˆåçš„æ•ˆæœ
document.addEventListener('DOMContentLoaded', function() {
    // ç»“æœåŠ¨ç”»æ•ˆæœ
    const resultHeader = document.querySelector('.result-header');
    if (resultHeader) {
        resultHeader.style.opacity = '0';
        resultHeader.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
            resultHeader.style.transition = 'all 0.6s ease-out';
            resultHeader.style.opacity = '1';
            resultHeader.style.transform = 'translateY(0)';
        }, 100);
    }
    
    // è‡ªåŠ¨æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
    setTimeout(() => {
        resultHeader.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
        });
    }, 300);
});

// é”®ç›˜å¿«æ·é”®
document.addEventListener('keydown', function(e) {
    switch(e.key) {
        case 'Escape':
            // ESCé”®è¿”å›ç—…ä¾‹
            window.location.href = "{% url 'student_case_detail' exercise.case.id %}";
            break;
        case 'Enter':
            // Enteré”®ç»§ç»­å­¦ä¹ 
            window.location.href = "{% url 'clinical_case_list' %}";
            break;
    }
});
</script>
{% endblock %}