{% extends 'base.html' %}
{% load static %}

{% block title %}å­¦ç”Ÿä»ªè¡¨æ¿ - çœ¼ç§‘ä¸´åºŠè®­ç»ƒç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>æˆ‘çš„å­¦ä¹ è¿›åº¦</h2>
    </div>
    <div class="card-body">
        <div class="stats-grid">
            <div class="stat-card" role="status" aria-label="æ€»ä½“å­¦ä¹ è¿›åº¦">
                <div class="stat-number">{{ progress.progress_percentage|floatformat:1 }}%</div>
                <div class="stat-label">æ€»ä½“è¿›åº¦</div>
            </div>
            <div class="stat-card" role="status" aria-label="å·²å®Œæˆç—…ä¾‹æ•°é‡">
                <div class="stat-number">{{ completed_cases|default:0 }}</div>
                <div class="stat-label">å·²å®Œæˆç—…ä¾‹</div>
            </div>
            <div class="stat-card" role="status" aria-label="å·²å®Œæˆç»ƒä¹ æ•°é‡">
                <div class="stat-number">{{ completed_exercises|default:0 }}</div>
                <div class="stat-label">å·²å®Œæˆç»ƒä¹ </div>
            </div>
            <div class="stat-card" role="status" aria-label="æ€»å­¦ä¹ æ—¶é•¿">
                <div class="stat-number">{{ progress.total_study_time|default:0 }}</div>
                <div class="stat-label">å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</div>
            </div>
        </div>

        <div class="progress-container" style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 20px 0;">
            <div class="progress-bar" 
                 style="background: #b71c1c; height: 20px; border-radius: 10px; transition: width 0.3s; width: 0%;" 
                 data-progress="{{ progress.progress_percentage|floatformat:1 }}"></div>
            <div style="text-align: center; margin-top: 5px; color: #666;">å­¦ä¹ è¿›åº¦ï¼š{{ completed_cases }}/{{ total_cases }} ä¸ªç—…ä¾‹</div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <a href="{% url 'clinical_case_list' %}" class="btn" style="margin-right: 15px; background: #007bff; color: white;">
                <i class="fas fa-stethoscope"></i> ä¸´åºŠæ¨ç†å­¦ä¹ 
            </a>
            <a href="{% url 'student_case_list' %}" class="btn secondary" style="margin-right: 15px;">ä¼ ç»Ÿç—…ä¾‹å­¦ä¹ </a>
            <a href="{% url 'student_mock_exam_list' %}" class="btn secondary" style="margin-right: 15px;">æ¨¡æ‹Ÿè€ƒè¯•</a>
            <a href="{% url 'student_exercise_list' %}" class="btn secondary">ç»ƒä¹ é¢˜ç›®</a>
        </div>
    </div>
</div>

{% if recent_exams %}
<div class="card">
    <div class="card-header">
        <h3>æœ€è¿‘çš„è€ƒè¯•è®°å½•</h3>
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
                <tr>
                    <th>è€ƒè¯•ç±»å‹</th>
                    <th>å¾—åˆ†</th>
                    <th>é¢˜ç›®æ•°</th>
                    <th>æ­£ç¡®ç‡</th>
                    <th>è€ƒè¯•æ—¶é—´</th>
                </tr>
            </thead>
            <tbody>
                {% for exam in recent_exams %}
                <tr>
                    <td>{{ exam.get_exam_type_display|default:"æœªçŸ¥ç±»å‹" }}</td>
                    <td><strong>{{ exam.score|floatformat:1|default:"0.0" }}åˆ†</strong></td>
                    <td>{{ exam.total_questions|default:0 }}</td>
                    <td>{{ exam.correct_answers|default:0 }}/{{ exam.total_questions|default:0 }}</td>
                    <td>{{ exam.created_at|date:"Y-m-d H:i"|default:"æœªçŸ¥æ—¶é—´" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if recent_exams|length >= 5 %}
        <div style="text-align: center; margin-top: 15px;">
            <a href="{% url 'student_mock_exam_list' %}" class="btn secondary">æŸ¥çœ‹æ›´å¤šè€ƒè¯•è®°å½•</a>
        </div>
        {% endif %}
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-header">
        <h3>å¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…</h3>
    </div>
    <div class="card-body" style="text-align: center; padding: 40px 20px;">
        <p style="color: #666; margin-bottom: 20px;">è¿˜æ²¡æœ‰è€ƒè¯•è®°å½•ï¼Œå¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡æ¨¡æ‹Ÿè€ƒè¯•å§ï¼</p>
        <a href="{% url 'student_mock_exam_list' %}" class="btn">ç«‹å³å¼€å§‹æ¨¡æ‹Ÿè€ƒè¯•</a>
    </div>
</div>
{% endif %}

<script>
// åŠ¨æ€è®¾ç½®è¿›åº¦æ¡å®½åº¦
document.addEventListener('DOMContentLoaded', function() {
    const progressBar = document.querySelector('.progress-bar');
    if (progressBar) {
        const progress = progressBar.dataset.progress;
        // å»¶è¿Ÿè®¾ç½®å®½åº¦ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœ
        setTimeout(() => {
            progressBar.style.width = progress + '%';
        }, 300);
        
        // æ·»åŠ é¢œè‰²å˜åŒ–
        const progressValue = parseFloat(progress);
        if (progressValue >= 80) {
            progressBar.style.background = '#28a745'; // ç»¿è‰²
        } else if (progressValue >= 60) {
            progressBar.style.background = '#ffc107'; // é»„è‰²
        } else if (progressValue >= 40) {
            progressBar.style.background = '#fd7e14'; // æ©™è‰²
        }
        // é»˜è®¤çº¢è‰² #b71c1c
        
        // æ·»åŠ å®Œæˆåº¦æç¤º
        if (progressValue >= 100) {
            const congratsMsg = document.createElement('div');
            congratsMsg.style.cssText = 'background: #d4edda; color: #155724; padding: 12px; border-radius: 4px; margin: 10px 0; text-align: center;';
            congratsMsg.innerHTML = 'ğŸ‰ æ­å–œä½ å®Œæˆäº†æ‰€æœ‰ç—…ä¾‹çš„å­¦ä¹ ï¼';
            progressBar.parentElement.after(congratsMsg);
        }
    }
    
    // æ·»åŠ ç»Ÿè®¡å¡ç‰‡çš„åŠ¨ç”»æ•ˆæœ
    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'all 0.5s ease';
        
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, 100 + index * 100);
    });
});
</script>
{% endblock %}