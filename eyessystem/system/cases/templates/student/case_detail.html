{% extends 'base.html' %}
{% load static %}

{% block title %}{{ case.name }} - 病例详情{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>{{ case.name }}</h2>
        <a href="{% url 'clinical_case_list' %}" class="btn secondary" style="float: right;">返回列表</a>
    </div>
    <div class="card-body">
        {% if case.image %}
        <div style="text-align: center; margin-bottom: 30px;">
            <img src="{{ case.image.url }}" alt="{{ case.name }}" style="max-width: 100%; max-height: 400px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        </div>
        {% endif %}

        <div class="case-info" style="margin-bottom: 30px;">
            <h3 style="color: #b71c1c; margin-bottom: 15px;">病例描述</h3>
            <p style="line-height: 1.8; margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 4px;">
                {{ case.description|linebreaks }}
            </p>

            <h3 style="color: #b71c1c; margin-bottom: 15px;">主要症状</h3>
            <p style="line-height: 1.8; margin-bottom: 20px; padding: 20px; background: #fff3e0; border-radius: 4px;">
                {{ case.symptoms|linebreaks }}
            </p>

            <h3 style="color: #b71c1c; margin-bottom: 15px;">检查结果</h3>
            <p style="line-height: 1.8; margin-bottom: 20px; padding: 20px; background: #e8f5e8; border-radius: 4px;">
                {{ case.exams|linebreaks }}
            </p>
        </div>

        <div class="exercises-section">
            <h3 style="color: #b71c1c; margin-bottom: 20px;">相关练习题目</h3>
            {% if exercises %}
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    {% for exercise in exercises %}
                    <div class="exercise-card" style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; background: white; cursor: pointer;" onclick="location.href='{% url 'student_exercise' exercise.id %}'">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span class="exercise-type" style="background: #b71c1c; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                {{ exercise.get_question_type_display }}
                            </span>
                            <span style="color: #666; font-size: 0.9rem;">
                                难度: {% for i in "12345"|make_list %}{% if forloop.counter <= exercise.difficulty %}★{% else %}☆{% endif %}{% endfor %}
                            </span>
                        </div>
                        <p style="font-weight: bold; margin-bottom: 10px; line-height: 1.4;">
                            {{ exercise.question|truncatewords:15 }}
                        </p>
                        <div style="text-align: right;">
                            <span class="btn" style="padding: 6px 12px; font-size: 0.9rem;">开始答题</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="text-align: center; padding: 40px; color: #666; background: #f8f9fa; border-radius: 8px;">
                    <p>暂无练习题目</p>
                    <p>请联系教师添加相关练习</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.exercise-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transition: all 0.2s;
}
</style>
{% endblock %}