<!DOCTYPE html>
<html>
<head>
    <title>删除功能前端测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .test-section { border: 1px solid #ddd; margin: 20px 0; padding: 20px; border-radius: 5px; }
        .btn { padding: 10px 20px; margin: 5px; text-decoration: none; border: none; border-radius: 3px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-success { background: #28a745; color: white; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>删除功能前端调试页面</h1>
    
    <div class="test-section">
        <h3>测试1: 直接访问删除页面</h3>
        <p>点击下面的链接，应该跳转到删除确认页面：</p>
        <a href="/teacher/clinical-cases/CC1760426748/delete/" class="btn btn-primary" target="_blank">
            访问删除确认页面
        </a>
    </div>
    
    <div class="test-section">
        <h3>测试2: 模拟无JavaScript的删除表单</h3>
        <p>这个表单没有JavaScript干扰，直接提交：</p>
        <form action="/teacher/clinical-cases/CC1760426748/delete/" method="post" target="_blank">
            {% csrf_token %}
            <label>
                <input type="checkbox" name="confirm_delete" value="on" required> 我确认删除
            </label><br><br>
            <button type="submit" class="btn btn-danger">无JavaScript删除</button>
        </form>
    </div>
    
    <div class="test-section">
        <h3>测试3: JavaScript调试</h3>
        <p>测试表单提交和事件处理：</p>
        <form id="testForm" action="/teacher/clinical-cases/CC1760426748/delete/" method="post">
            {% csrf_token %}
            <label>
                <input type="checkbox" id="testConfirm" name="confirm_delete" value="on" required> 我确认删除
            </label><br><br>
            <button type="submit" class="btn btn-danger" id="testSubmit">JavaScript测试删除</button>
        </form>
        
        <div class="log" id="jsLog">等待JavaScript事件...</div>
    </div>
    
    <div class="test-section">
        <h3>测试4: 当前页面信息</h3>
        <div id="pageInfo">
            <p><strong>当前URL:</strong> <span id="currentUrl"></span></p>
            <p><strong>用户代理:</strong> <span id="userAgent"></span></p>
            <p><strong>Referrer:</strong> <span id="referrer"></span></p>
        </div>
    </div>

    <script>
    function log(message) {
        const logDiv = document.getElementById('jsLog');
        const time = new Date().toLocaleTimeString();
        logDiv.innerHTML += `[${time}] ${message}<br>`;
        logDiv.scrollTop = logDiv.scrollHeight;
        console.log(message);
    }
    
    // 页面加载信息
    document.getElementById('currentUrl').textContent = window.location.href;
    document.getElementById('userAgent').textContent = navigator.userAgent;
    document.getElementById('referrer').textContent = document.referrer || '无';
    
    // 表单事件监听
    document.addEventListener('DOMContentLoaded', function() {
        log('页面DOM加载完成');
        
        const form = document.getElementById('testForm');
        const checkbox = document.getElementById('testConfirm');
        const submitBtn = document.getElementById('testSubmit');
        
        // 复选框事件
        checkbox.addEventListener('change', function() {
            log(`复选框状态改变: ${this.checked}`);
            submitBtn.disabled = !this.checked;
        });
        
        // 表单提交事件
        form.addEventListener('submit', function(e) {
            log('表单提交事件触发');
            log(`表单action: ${this.action}`);
            log(`表单method: ${this.method}`);
            log(`复选框状态: ${checkbox.checked}`);
            
            const formData = new FormData(this);
            log('表单数据:');
            for (let [key, value] of formData.entries()) {
                log(`  ${key}: ${value}`);
            }
            
            if (!confirm('确定要执行删除测试吗？这将真的删除数据！')) {
                e.preventDefault();
                log('用户取消删除');
                return false;
            }
            
            log('表单即将提交...');
        });
        
        // 提交按钮点击事件
        submitBtn.addEventListener('click', function(e) {
            log('提交按钮被点击');
        });
        
        log('所有事件监听器已设置');
    });
    </script>
</body>
</html>