<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ£€æŸ¥é€‰é¡¹APIæµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">æ£€æŸ¥é€‰é¡¹APIæµ‹è¯•</h1>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>APIå“åº”æµ‹è¯•</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="caseId" class="form-label">æ¡ˆä¾‹ID:</label>
                        <input type="text" class="form-control" id="caseId" value="CASE_001" placeholder="è¾“å…¥æ¡ˆä¾‹ID">
                    </div>
                    <button class="btn btn-primary" onclick="testAPI()">æµ‹è¯•æ–°çš„æ£€æŸ¥é€‰é¡¹API</button>
                    
                    <div id="results" class="mt-4"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h6>æµ‹è¯•è¯´æ˜</h6>
                </div>
                <div class="card-body">
                    <p class="small">è¿™ä¸ªæµ‹è¯•é¡µé¢ç”¨äºéªŒè¯æ–°çš„æ£€æŸ¥é€‰é¡¹APIåŠŸèƒ½ï¼š</p>
                    <ul class="small">
                        <li>æ··åˆå¿…é€‰é¡¹å’Œå¹²æ‰°é¡¹</li>
                        <li>æ™ºèƒ½æ•°é‡è°ƒæ•´</li>
                        <li>ç±»å‹å¤šæ ·æ€§ä¿è¯</li>
                        <li>éšæœºé¡ºåºæ‰“ä¹±</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function testAPI() {
    const caseId = document.getElementById('caseId').value;
    const resultsDiv = document.getElementById('results');
    
    resultsDiv.innerHTML = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';
    
    $.getJSON('/api/clinical/case/' + caseId + '/examinations/')
        .done(function(response) {
            displayResults(response);
        })
        .fail(function(xhr, status, error) {
            resultsDiv.innerHTML = `
                <div class="alert alert-danger">
                    <h6>è¯·æ±‚å¤±è´¥</h6>
                    <p>çŠ¶æ€ç : ${xhr.status}</p>
                    <p>é”™è¯¯ä¿¡æ¯: ${error}</p>
                    <pre>${xhr.responseText}</pre>
                </div>
            `;
        });
}

function displayResults(response) {
    const resultsDiv = document.getElementById('results');
    
    let html = '';
    
    if (response.success) {
        const data = response.data;
        
        // APIå“åº”æ¦‚è§ˆ
        html += `
            <div class="alert alert-success">
                <h6>âœ… APIè°ƒç”¨æˆåŠŸ</h6>
                <p><strong>æ¶ˆæ¯:</strong> ${response.message}</p>
            </div>
        `;
        
        // ç»Ÿè®¡ä¿¡æ¯
        html += `
            <div class="card mb-3">
                <div class="card-header">
                    <h6>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h4 class="text-primary">${data.total_count || 0}</h4>
                                <small>æ€»æ£€æŸ¥é¡¹</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h4 class="text-success">${data.required_count || 0}</h4>
                                <small>å¿…é€‰é¡¹</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h4 class="text-warning">${data.distractor_count || 0}</h4>
                                <small>å¹²æ‰°é¡¹</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <span class="badge bg-info">${data.mode || 'unknown'}</span><br>
                                <small>æ¨¡å¼</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // æ£€æŸ¥é¡¹ç›®åˆ—è¡¨
        if (data.examination_options && data.examination_options.length > 0) {
            html += `
                <div class="card">
                    <div class="card-header">
                        <h6>ğŸ” æ£€æŸ¥é¡¹ç›®åˆ—è¡¨</h6>
                    </div>
                    <div class="card-body">
            `;
            
            data.examination_options.forEach((option, index) => {
                const badgeClass = option.is_case_required ? 'bg-success' : (option.is_distractor ? 'bg-warning' : 'bg-secondary');
                const badgeText = option.is_case_required ? 'å¿…é€‰' : (option.is_distractor ? 'å¹²æ‰°é¡¹' : 'å¸¸è§„');
                
                html += `
                    <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                        <div>
                            <strong>${option.name}</strong>
                            <span class="badge ${badgeClass} ms-2">${badgeText}</span>
                            ${option.type ? `<span class="text-muted ms-2">[${option.type}]</span>` : ''}
                            ${option.description ? `<br><small class="text-muted">${option.description}</small>` : ''}
                        </div>
                        <div>
                            <small class="text-muted">#${option.id}</small>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
        }
        
    } else {
        html += `
            <div class="alert alert-danger">
                <h6>âŒ APIè¿”å›å¤±è´¥</h6>
                <p><strong>é”™è¯¯æ¶ˆæ¯:</strong> ${response.message}</p>
            </div>
        `;
    }
    
    resultsDiv.innerHTML = html;
}

// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
$(document).ready(function() {
    testAPI();
});
</script>

</body>
</html>