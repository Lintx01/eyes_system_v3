# 鉴别诊断智能指导系统 - 功能说明

## 🎯 系统概述

本系统实现了眼科临床推理教学中的**循序渐进智能指导功能**，当学生在鉴别诊断阶段选择错误时，系统会根据尝试次数提供不同级别的指导，帮助学生逐步理解正确的诊断思路。

## ✨ 核心功能

### 1. 多选鉴别诊断
- 支持学生同时选择多个鉴别诊断选项
- 从单选按钮改为复选框，允许灵活选择
- 系统会检查所有正确诊断是否都被选中

### 2. 三级智能指导体系

#### 🟢 级别1 - 轻度提示 (第1次错误)
- 提供基础的思考方向
- 示例："结合患者的糖尿病病史和眼底检查"
- 不透露具体答案，引导学生思考

#### 🟡 级别2 - 中度提示 (第2次错误)  
- 提供更具体的临床特征
- 示例："微血管瘤、出血点和渗出物是糖尿病视网膜病变的典型表现"
- 帮助学生回忆诊断标准

#### 🔴 级别3 - 强提示 (第3次及以上错误)
- 提供详细的诊断依据
- 示例："该患者有糖尿病史，眼底可见微血管瘤、出血和硬性渗出，诊断为糖尿病视网膜病变"
- 在高级别指导下会显示正确诊断标识

### 3. 动态评分机制
- **完全正确**：基础100分，根据尝试次数扣分（每次尝试-10分，最低60分）
- **部分正确**：暂不给分，继续指导
- **完全错误**：0分，提供基础指导

## 🔧 技术实现

### 后端改进
1. **模型扩展**：
   - `StudentClinicalSession`添加`diagnosis_attempt_count`和`diagnosis_guidance_level`字段
   - `DiagnosisOption`添加`hint_level_1/2/3`三级指导字段
   - 支持`selected_diagnoses`JSON字段存储多个诊断

2. **API增强**：
   - `submit_diagnosis_choice`视图支持多诊断处理
   - 智能判断诊断完整性和正确性  
   - 根据尝试次数提供相应级别指导
   - 允许重复尝试直到完全正确

### 前端优化
1. **界面改进**：
   - 诊断选项从单选改为多选复选框
   - 支持指导信息的动态显示
   - 重新选择界面的渐进式提示展示

2. **交互增强**：
   - `renderDiagnosisOptionsWithGuidance`函数处理指导界面
   - 智能按钮状态管理（提交→重新提交→下一步）
   - 视觉反馈和用户体验优化

## 📋 工作流程

```
学生进入诊断阶段
     ↓
选择鉴别诊断选项（多选）
     ↓  
系统检查选择正确性
     ↓
┌─────────────────┬─────────────────┐
│  完全正确        │  不完全正确      │
│  ↓              │  ↓              │
│ 计算得分         │ 增加尝试次数     │
│ 进入治疗阶段     │ 提供相应指导     │
│                 │ 允许重新选择     │
│                 │ ↓              │
│                 │ 返回诊断选择     │
└─────────────────┴─────────────────┘
```

## 🎓 教学价值

### 1. 循序渐进学习
- 避免直接给出答案，培养独立思考
- 根据学生水平动态调整指导深度
- 鼓励多次尝试，从错误中学习

### 2. 临床思维训练
- 模拟真实临床决策过程
- 强化鉴别诊断的重要性
- 培养综合分析能力

### 3. 个性化指导
- 基于尝试次数提供适度帮助
- 防止学生过度依赖提示
- 保持学习的挑战性和成就感

## 🚀 使用效果

### 第1次尝试（轻度提示）
```
您选择了1个正确诊断，但还有2个正确诊断未选择，同时选择了1个错误诊断。
请重新思考并调整您的选择。

提示：请仔细回顾患者的症状、体征和检查结果。
```

### 第2次尝试（中度提示）  
```
提示：请仔细回顾患者的症状、体征和检查结果。
关于xxx诊断: 注意患者的眼压值和视野缺损情况
```

### 第3次尝试（强提示）
```
详细指导：
✓ 糖尿病视网膜病变: 这是正确的诊断
✗ 青光眼: 该患者眼压正常，无青光眼征象，不符合青光眼诊断标准
```

## 📊 系统状态

- ✅ **数据库模型** - 已更新支持智能指导字段
- ✅ **后端API** - 已实现循序渐进逻辑  
- ✅ **前端界面** - 已支持多选和指导显示
- ✅ **指导内容** - 已添加示例指导数据
- ✅ **测试验证** - 系统功能完整可用

## 🔄 下一步优化

1. **指导内容丰富**：为更多眼科疾病添加专业指导内容
2. **AI增强**：结合大语言模型生成个性化指导
3. **学习分析**：统计学生错误模式，优化指导策略
4. **多媒体指导**：添加图像标注、视频解释等丰富形式

---

**系统现已准备就绪！** 🎉

学生在进行鉴别诊断时，如果选择不完全正确，将获得循序渐进的智能指导，直到掌握正确的诊断思路。