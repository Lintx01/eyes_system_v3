# 用户注册和修改密码功能 - 使用说明

## 功能概述

已成功添加以下功能：
1. ✅ 学生自主注册功能
2. ✅ 用户修改密码功能

## 功能详情

### 1. 用户注册功能

**访问路径**: `http://127.0.0.1:8000/register/`

**功能特点**:
- 学生可以自主注册账号
- 自动加入"Students"用户组
- 支持用户名、密码、邮箱、姓名等信息
- 完善的表单验证

**字段说明**:
- **用户名** (必填): 建议使用学号，至少3个字符
- **密码** (必填): 至少6个字符
- **确认密码** (必填): 必须与密码一致
- **邮箱** (选填): 用于找回密码
- **姓** (选填): 学生姓氏
- **名** (选填): 学生名字

**验证规则**:
- 用户名不能重复
- 用户名至少3个字符
- 密码至少6个字符
- 两次密码输入必须一致
- 邮箱不能重复（如果填写）

**注册流程**:
1. 访问登录页面，点击"还没有账号？立即注册"
2. 填写注册表单
3. 提交后自动跳转到登录页面
4. 使用新账号登录

### 2. 修改密码功能

**访问路径**: 
- 顶部导航栏"修改密码"按钮
- 直接访问: `http://127.0.0.1:8000/change-password/`

**功能特点**:
- 要求输入当前密码验证身份
- 支持在线修改密码
- 修改后不会退出登录（自动更新session）

**字段说明**:
- **当前密码** (必填): 用于验证身份
- **新密码** (必填): 至少6个字符
- **确认新密码** (必填): 必须与新密码一致

**验证规则**:
- 必须正确输入当前密码
- 新密码至少6个字符
- 两次新密码输入必须一致
- 新密码不能与当前密码相同

**修改流程**:
1. 登录后点击顶部"修改密码"按钮
2. 输入当前密码
3. 输入新密码并确认
4. 提交后自动跳转到首页

## 界面位置

### 登录页面增强
- 添加了"还没有账号？立即注册"链接
- 点击即可跳转到注册页面

### 导航栏增强
- 在用户名右侧添加"修改密码"按钮
- 样式与退出登录按钮保持一致
- 位于"退出登录"按钮左侧

## 文件清单

### 后端文件
- `cases/views.py`: 添加了 `register_view` 和 `change_password_view` 函数
- `cases/urls.py`: 添加了对应的URL路由

### 前端模板
- `templates/register.html`: 注册页面
- `templates/change_password.html`: 修改密码页面
- `templates/login.html`: 添加了注册链接
- `templates/base.html`: 添加了修改密码按钮和样式

## 测试建议

### 测试注册功能
1. 访问 http://127.0.0.1:8000/register/
2. 测试各种验证场景：
   - ✓ 正常注册
   - ✓ 用户名重复
   - ✓ 密码不一致
   - ✓ 用户名过短
   - ✓ 密码过短
3. 注册成功后尝试登录

### 测试修改密码功能
1. 使用现有账号登录
2. 点击"修改密码"
3. 测试各种场景：
   - ✓ 当前密码错误
   - ✓ 新密码过短
   - ✓ 两次新密码不一致
   - ✓ 新密码与当前密码相同
   - ✓ 正常修改密码
4. 修改成功后验证：
   - 未退出登录
   - 可以使用新密码登录

## 安全特性

1. **密码加密**: 使用Django内置的密码哈希机制
2. **CSRF保护**: 所有表单都包含CSRF令牌
3. **身份验证**: 修改密码需要验证当前密码
4. **Session保持**: 修改密码后使用 `update_session_auth_hash` 保持登录状态
5. **用户组管理**: 注册用户自动加入Students组

## 未来增强建议

1. **找回密码功能**: 通过邮箱重置密码
2. **邮箱验证**: 注册时发送验证邮件
3. **密码强度检测**: 前端实时显示密码强度
4. **登录日志**: 记录用户登录历史
5. **两步验证**: 增强账号安全性

## 维护说明

- 所有验证逻辑都在后端完成，确保安全性
- 错误信息清晰明了，帮助用户快速定位问题
- 页面样式与现有设计风格保持一致
- 代码遵循Django最佳实践

---

**创建时间**: 2025-11-10
**版本**: v1.0
**状态**: ✅ 已完成并测试
